server {
        server_name _;
        root /config/www/pydio;
        index index.php;
        listen 443 ssl;
        keepalive_requests    10;
        keepalive_timeout     60 60;
        access_log /config/log/pydio/access_pydio7_log;
        error_log /config/log/pydio/error_pydio7_log;

        ssl_certificate /config/keys/cert.crt;
        ssl_certificate_key /config/keys/cert.key;
        client_max_body_size 0;
        client_body_buffer_size 128k;

        # All non existing files are redirected to index.php
        if ( !-e $request_filename ) {
                # For old links generated from Pydio 6
                rewrite ^/data/public/([a-zA-Z0-9_-]+)$ /public/$1?;
                rewrite ^(.*)$ /index.php last;
        }
        
        
        # Prevent Clickjacking
        add_header X-Frame-Options "SAMEORIGIN";


        location ~* ^/(?:\.|conf|data/(?:files|personal|logs|plugins|tmp|cache)|plugins/editor.zoho/agent/files) {
                deny all;
        }
        # Enables PHP
        location ~ \.php$ {
                include /etc/nginx/fastcgi_params;
                try_files $uri =404;
                fastcgi_pass 127.0.0.1:9000;
        }

       # Enables Caching
        location ~* \.(ico|css|js)$ {
                expires 7d;
                add_header Pragma public;
                add_header Cache-Control "public, must-revalidate, proxy-revalidate";
        }
}
